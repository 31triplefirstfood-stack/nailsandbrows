// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

// =====================
// Enums
// =====================

enum Role {
  ADMIN
  STAFF
}

enum ServiceCategory {
  NAILS
  EYELASH
  PERMANENT_MAKEUP
  COURSE_STUDY
}

enum AppointmentStatus {
  PENDING
  CONFIRMED
  COMPLETED
  CANCELLED
}

enum PaymentMethod {
  CASH
  TRANSFER
  CREDIT_CARD
  PROMPTPAY
}

// =====================
// Models
// =====================

model User {
  id        String   @id @default(cuid())
  name      String
  email     String   @unique
  password  String
  role      Role     @default(STAFF)
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@map("users")
}

model ServiceItem {
  id              String          @id @default(cuid())
  name            String
  category        ServiceCategory @default(NAILS)
  price           Decimal         @db.Decimal(10, 2)
  durationMinutes Int             @default(60)
  isActive        Boolean         @default(true)
  createdAt       DateTime        @default(now())
  updatedAt       DateTime        @updatedAt

  appointments Appointment[]
  transactionItems TransactionItem[]

  @@map("service_items")
}

model Appointment {
  id           String            @id @default(cuid())
  customerName String
  phone        String            @default("")
  serviceId    String
  service      ServiceItem       @relation(fields: [serviceId], references: [id])
  date         DateTime
  time         String
  status       AppointmentStatus @default(PENDING)
  notes        String            @default("")
  createdAt    DateTime          @default(now())
  updatedAt    DateTime          @updatedAt

  @@map("appointments")
}

model Transaction {
  id            String        @id @default(cuid())
  customerName  String        @default("")
  employeeName  String        @default("")
  totalAmount   Decimal       @db.Decimal(10, 2)
  paymentMethod PaymentMethod @default(CASH)
  description   String        @default("")
  date          DateTime      @default(now())
  createdAt     DateTime      @default(now())
  updatedAt     DateTime      @updatedAt

  items TransactionItem[]

  @@map("transactions")
}

model TransactionItem {
  id            String      @id @default(cuid())
  transactionId String
  transaction   Transaction @relation(fields: [transactionId], references: [id], onDelete: Cascade)
  serviceId     String
  service       ServiceItem @relation(fields: [serviceId], references: [id])
  quantity      Int         @default(1)
  price         Decimal     @db.Decimal(10, 2)
  createdAt     DateTime    @default(now())

  @@map("transaction_items")
}

model Expense {
  id          String   @id @default(cuid())
  amount      Decimal  @db.Decimal(10, 2)
  date        DateTime @default(now())
  description String
  category    String   @default("อื่นๆ")
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  @@map("expenses")
}

model SystemSettings {
  id            String   @id @default(cuid())
  storeName     String   @default("Nails & Brows")
  storeLogo     String?  @db.Text
  dailyTarget   Decimal  @db.Decimal(10, 2) @default(1000)
  monthlyTarget Decimal  @db.Decimal(10, 2) @default(30000)
  pagePin       String   @default("1234")
  updatedAt     DateTime @updatedAt

  @@map("system_settings")
}
